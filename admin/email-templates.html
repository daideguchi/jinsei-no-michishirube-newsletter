<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ç”»é¢ - ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›† | äººç”Ÿã®é“æ¨™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .template-preview {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f8f8;
        }
        .email-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
        }
        .section-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .zen-gradient {
            background: linear-gradient(135deg, #2C5F41 0%, #4A7C59 100%);
        }
        .admin-sidebar {
            background: linear-gradient(180deg, #1f2937 0%, #374151 100%);
        }
    </style>
<script src="/admin/auth-check.js"></script>
</head>
<body class="bg-gray-50">
    <!-- ç®¡ç†è€…ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="admin-sidebar shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl">ğŸ›¡ï¸</span>
                    <span class="ml-2 text-xl font-bold text-white">äººç”Ÿã®é“æ¨™ ç®¡ç†è€…ç”»é¢</span>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="/admin/dashboard" class="text-gray-300 hover:text-white">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                    <a href="/admin/email-templates" class="text-white font-semibold">âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</a>
                    <a href="/admin/subscribers" class="text-gray-300 hover:text-white">ğŸ‘¥ èª­è€…ç®¡ç†</a>
                    <a href="/admin/analytics" class="text-gray-300 hover:text-white">ğŸ“ˆ åˆ†æ</a>
                    <a href="/admin/settings" class="text-gray-300 hover:text-white">âš™ï¸ è¨­å®š</a>
                    <button onclick="logout()" class="text-red-300 hover:text-red-100">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
    <div class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <nav class="text-sm">
                <span class="text-gray-500">ç®¡ç†è€…ç”»é¢</span>
                <span class="text-gray-400 mx-2">â€º</span>
                <span class="text-green-600 font-semibold">ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</span>
            </nav>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼çµ±è¨ˆ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100">
                        <span class="text-2xl">ğŸ“§</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">ç·é…ä¿¡æ•°</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalSent">1,247</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100">
                        <span class="text-2xl">ğŸ“ˆ</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">é–‹å°ç‡</p>
                        <p class="text-2xl font-bold text-green-600" id="openRate">32.5%</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100">
                        <span class="text-2xl">ğŸ–±ï¸</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">ã‚¯ãƒªãƒƒã‚¯ç‡</p>
                        <p class="text-2xl font-bold text-purple-600" id="clickRate">8.2%</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-red-100">
                        <span class="text-2xl">âš ï¸</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">é…ä¿¡å¤±æ•—</p>
                        <p class="text-2xl font-bold text-red-600" id="failureRate">0.3%</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- å·¦å´: ç·¨é›†ã‚¨ãƒªã‚¢ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">ğŸ“ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</h2>
                    <div class="flex space-x-2">
                        <button onclick="saveToSheets()" class="zen-gradient text-white px-4 py-2 rounded-lg hover:opacity-90 text-sm">
                            ğŸ’¾ ä¿å­˜
                        </button>
                        <button onclick="syncFromSheets()" class="border border-green-600 text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 text-sm">
                            ğŸ”„ åŒæœŸ
                        </button>
                        <button onclick="sendTestEmail()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                            ğŸ“¨ ãƒ†ã‚¹ãƒˆé€ä¿¡
                        </button>
                    </div>
                </div>
                
                <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</label>
                    <select id="templateSelect" onchange="loadTemplate()" class="w-full border-gray-300 rounded-lg text-sm">
                        <option value="welcome">ğŸ‰ ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ï¼ˆç™»éŒ²ç›´å¾Œï¼‰</option>
                        <option value="day1">1ï¸âƒ£ Day 1 - å¿ƒã‚’æ•´ãˆã‚‹æ™ºæ…§</option>
                        <option value="day3">3ï¸âƒ£ Day 3 - äººé–“é–¢ä¿‚ã®æ™ºæ…§</option>
                        <option value="day7">7ï¸âƒ£ Day 7 - ä¸€é€±é–“ã®æŒ¯ã‚Šè¿”ã‚Š</option>
                    </select>
                </div>

                <!-- ã‚¯ã‚¤ãƒƒã‚¯ç·¨é›†ã‚¿ãƒ– -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-8">
                        <button onclick="showTab('basic')" id="basicTab" class="border-b-2 border-green-500 py-2 px-1 text-sm font-medium text-green-600">
                            åŸºæœ¬è¨­å®š
                        </button>
                        <button onclick="showTab('content')" id="contentTab" class="border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                            ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                        </button>
                        <button onclick="showTab('advanced')" id="advancedTab" class="border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                            é«˜åº¦ãªè¨­å®š
                        </button>
                    </nav>
                </div>

                <!-- åŸºæœ¬è¨­å®šã‚¿ãƒ– -->
                <div id="basicContent" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ“§ ä»¶å</label>
                        <input type="text" id="subject" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm" 
                               placeholder="ã€äººç”Ÿã®é“æ¨™ã€‘ãƒ¡ãƒ¼ãƒ«ã®ä»¶å">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ</label>
                        <input type="text" id="previewText" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                               placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¡¨ç¤ºã•ã‚Œã‚‹çŸ­ã„èª¬æ˜æ–‡">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" id="headerTitle" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                               placeholder="ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã®å†’é ­ã‚¿ã‚¤ãƒˆãƒ«">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ“ ãƒ¡ã‚¤ãƒ³æœ¬æ–‡</label>
                        <textarea id="mainContent" rows="4" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                                  placeholder="{firstName} æ§˜ã€æœ¬æ–‡ã‚’ã“ã“ã«å…¥åŠ›..."></textarea>
                        <p class="text-xs text-gray-500 mt-1">ğŸ’¡ {firstName} {lastName} ã§åå‰ãŒè‡ªå‹•æŒ¿å…¥ã•ã‚Œã¾ã™</p>
                    </div>
                </div>

                <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ãƒ– -->
                <div id="contentArea" class="space-y-6 hidden">
                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1 -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold mb-3 text-green-700">ğŸ“ ã‚»ã‚¯ã‚·ãƒ§ãƒ³1</h3>
                        <input type="text" id="section1Title" class="w-full border-gray-300 rounded-lg px-3 py-2 mb-2 text-sm"
                               placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«">
                        <textarea id="section1Content" rows="3" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                                  placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹"></textarea>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2 -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold mb-3 text-green-700">ğŸ“ ã‚»ã‚¯ã‚·ãƒ§ãƒ³2</h3>
                        <input type="text" id="section2Title" class="w-full border-gray-300 rounded-lg px-3 py-2 mb-2 text-sm"
                               placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰">
                        <textarea id="section2Content" rows="3" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                                  placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"></textarea>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3 -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold mb-3 text-green-700">ğŸ“ ã‚»ã‚¯ã‚·ãƒ§ãƒ³3</h3>
                        <input type="text" id="section3Title" class="w-full border-gray-300 rounded-lg px-3 py-2 mb-2 text-sm"
                               placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰">
                        <textarea id="section3Content" rows="3" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                                  placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ¯ ç· ã‚ã®è¨€è‘‰</label>
                        <textarea id="closingMessage" rows="3" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm"
                                  placeholder="ç· ã‚ããã‚Šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>
                    </div>
                </div>

                <!-- é«˜åº¦ãªè¨­å®šã‚¿ãƒ– -->
                <div id="advancedContent" class="space-y-4 hidden">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ“… é…ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°</label>
                            <select class="w-full border-gray-300 rounded-lg text-sm">
                                <option>å³åº§ã«é…ä¿¡</option>
                                <option>1æ—¥å¾Œ</option>
                                <option>3æ—¥å¾Œ</option>
                                <option>7æ—¥å¾Œ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ¯ å¯¾è±¡ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</label>
                            <select class="w-full border-gray-300 rounded-lg text-sm">
                                <option>å…¨èª­è€…</option>
                                <option>æ–°è¦èª­è€…ã®ã¿</option>
                                <option>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–èª­è€…ã®ã¿</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ·ï¸ ã‚¿ã‚°è¨­å®š</label>
                        <input type="text" class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm" 
                               placeholder="ä¾‹: mindfulness,leadership">
                    </div>
                </div>

                <button onclick="updatePreview()" class="w-full mt-6 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-semibold">
                    ğŸ”„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                </button>
            </div>

            <!-- å³å´: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                    <div class="flex space-x-2">
                        <button class="bg-gray-100 text-gray-700 px-3 py-1 rounded text-sm">ğŸ“± ãƒ¢ãƒã‚¤ãƒ«</button>
                        <button class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm">ğŸ’» ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—</button>
                    </div>
                </div>
                
                <!-- ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div class="template-preview">
                    <!-- ãƒ¡ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="mb-4 p-4 bg-gray-100 rounded">
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white text-sm font-bold">é“</div>
                            <div class="ml-3">
                                <p class="text-sm font-semibold text-gray-800">äººç”Ÿã®é“æ¨™ - ãƒ‡ã‚¸ã‚¿ãƒ«ä¼½è—</p>
                                <p class="text-xs text-gray-600">noreply@jinsei-michishirube.com</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">ä»¶å: <span id="previewSubject" class="font-semibold text-gray-800"></span></p>
                        <p class="text-sm text-gray-600 mt-1">å®›å…ˆ: å®Ÿéš›ã®èª­è€…ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—</p>
                    </div>

                    <!-- ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ -->
                    <div class="email-content" id="emailPreview">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                </div>

                <!-- çµ±è¨ˆæƒ…å ± -->
                <div class="mt-6 grid grid-cols-2 gap-4">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <h3 class="font-semibold text-blue-900 mb-2">ğŸ“Š äºˆæƒ³æˆæœ</h3>
                        <div class="text-sm text-blue-700 space-y-1">
                            <p>é–‹å°ç‡: <span class="font-semibold">32.5%</span></p>
                            <p>ã‚¯ãƒªãƒƒã‚¯ç‡: <span class="font-semibold">8.2%</span></p>
                        </div>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg">
                        <h3 class="font-semibold text-green-900 mb-2">â° é…ä¿¡æƒ…å ±</h3>
                        <div class="text-sm text-green-700 space-y-1">
                            <p>æœ€çµ‚æ›´æ–°: <span id="lastUpdated">2025-07-26</span></p>
                            <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span class="font-semibold">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆçœç•¥ - å‰å›ã¨åŒã˜ï¼‰
        const templates = {
            welcome: {
                subject: "ã€äººç”Ÿã®é“æ¨™ã€‘ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™",
                previewText: "æ˜æ—¥ã®æœ10æ™‚ã‹ã‚‰ã€7æ—¥é–“é€£ç¶šã§ã‚ãªãŸã®å¿ƒã‚’è±Šã‹ã«ã™ã‚‹æ™ºæ…§ã‚’ãŠé€ã‚Šã—ã¾ã™",
                headerTitle: "",
                mainContent: "{firstName} {lastName} æ§˜\n\nã€Œäººç”Ÿã®é“æ¨™ã€ãƒ¡ãƒ«ãƒã‚¬ã¸ã®ã”ç™»éŒ²ã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\næ˜æ—¥ã®æœ10æ™‚ã‹ã‚‰ã€7æ—¥é–“é€£ç¶šã§ã‚ãªãŸã®å¿ƒã‚’è±Šã‹ã«ã™ã‚‹æ™ºæ…§ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚",
                section1Title: "",
                section1Content: "",
                section2Title: "",
                section2Content: "",
                section3Title: "",
                section3Content: "",
                closingMessage: ""
            },
            day1: {
                subject: "ã€äººç”Ÿã®é“æ¨™ã€‘å¿ƒã‚’æ•´ãˆã‚‹æ™ºæ…§ã‚’ãŠå±Šã‘ã—ã¾ã™",
                previewText: "å¿™ã—ã„æ—¥å¸¸ã®ä¸­ã§ã‚‚å®Ÿè·µã§ãã‚‹ã€å¿ƒã‚’æ•´ãˆã‚‹3ã¤ã®æ–¹æ³•",
                headerTitle: "å¿ƒã‚’æ•´ãˆã‚‹3ã¤ã®å®Ÿè·µ",
                mainContent: "{firstName} æ§˜ã€ä»Šæ—¥ã¯å¿™ã—ã„æ—¥å¸¸ã®ä¸­ã§ã‚‚å®Ÿè·µã§ãã‚‹ã€å¿ƒã‚’æ•´ãˆã‚‹æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚",
                section1Title: "1. æœã®é™å¯‚ã®æ™‚é–“",
                section1Content: "ç›®è¦šã‚ãŸç›´å¾Œã®3åˆ†é–“ã€ä½•ã‚‚è€ƒãˆãšã€ãŸã å‘¼å¸ã«æ„è­˜ã‚’å‘ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚å¿ƒã®ä¸­ã®é¨’ãŒã—ã•ãŒã€é™ã‹ã«æ²ˆã‚“ã§ã„ãã®ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚",
                section2Title: "2. æ„Ÿè¬ã®ç™ºè¦‹",
                section2Content: "ä¸€æ—¥ã®çµ‚ã‚ã‚Šã«ã€ä»Šæ—¥èµ·ã“ã£ãŸå°ã•ãªã€Œã‚ã‚ŠãŒãŸã„ã“ã¨ã€ã‚’3ã¤æ€ã„æµ®ã‹ã¹ã¦ãã ã•ã„ã€‚æ—¥å¸¸ã«éš ã‚Œã¦ã„ã‚‹å¹¸ã›ã«æ°—ã¥ãåŠ›ãŒè‚²ã¾ã‚Œã¾ã™ã€‚",
                section3Title: "3. ãƒ‡ã‚¸ã‚¿ãƒ«ã®é™å¯‚",
                section3Content: "1æ—¥ã®ã†ã¡30åˆ†é–“ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’æ‰‹ã®å±Šã‹ãªã„å ´æ‰€ã«ç½®ã„ã¦ã¿ã¦ãã ã•ã„ã€‚å¿ƒã«ä½™ç™½ãŒç”Ÿã¾ã‚Œã€æœ¬å½“ã«å¤§åˆ‡ãªã“ã¨ã«æ„è­˜ãŒå‘ãã¾ã™ã€‚",
                closingMessage: "æ˜æ—¥ã¯ã€Œäººã¨ã®é–¢ã‚ã‚Šã®ä¸­ã§å¿ƒã‚’ä¿ã¤æ™ºæ…§ã€ã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã™ã€‚"
            },
            day3: {
                subject: "ã€äººç”Ÿã®é“æ¨™ã€‘äººé–“é–¢ä¿‚ã®æ™ºæ…§",
                previewText: "äººã¨ã®é–¢ã‚ã‚Šã®ä¸­ã§å¿ƒç©ã‚„ã‹ã§ã„ã‚‹ãŸã‚ã®å¤æ¥ã®æ™ºæ…§",
                headerTitle: "äººé–“é–¢ä¿‚ã«æ´»ã‹ã™å¿ƒã®æ™ºæ…§",
                mainContent: "{firstName} æ§˜ã€äººã¨ã®é–¢ã‚ã‚Šã®ä¸­ã§å¿ƒç©ã‚„ã‹ã§ã„ã‚‹ãŸã‚ã®å¤æ¥ã®æ™ºæ…§ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚",
                section1Title: "ç›¸æ‰‹ã®è¨€è‘‰ã®å¥¥ã‚’è´ã",
                section1Content: "äººãŒæ„Ÿæƒ…çš„ã«ãªã£ã¦ã„ã‚‹ã¨ãã€ãã®è¨€è‘‰ã§ã¯ãªãã€å¿ƒã®å¥¥ã«ã‚ã‚‹æ°—æŒã¡ã«è€³ã‚’å‚¾ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚æ€’ã‚Šã®å¥¥ã«ã¯ä¸å®‰ã‚„æ‚²ã—ã¿ãŒã€æ‰¹åˆ¤ã®å¥¥ã«ã¯ç†è§£ã•ã‚ŒãŸã„æƒ³ã„ãŒã‚ã‚‹ã“ã¨ãŒå¤šã„ã‚‚ã®ã§ã™ã€‚",
                section2Title: "è‡ªåˆ†ã®åå¿œã‚’è¦³å¯Ÿã™ã‚‹",
                section2Content: "ç›¸æ‰‹ã®è¨€å‹•ã«å¿ƒãŒä¹±ã‚ŒãŸã¨ãã€ä¸€åº¦æ·±å‘¼å¸ã‚’ã—ã¦ã€Œä»Šã€ç§ã¯ã©ã‚“ãªæ°—æŒã¡ã«ãªã£ã¦ã„ã‚‹ã ã‚ã†ã€ã¨è‡ªåˆ†è‡ªèº«ã‚’è¦³å¯Ÿã—ã¦ã¿ã¦ãã ã•ã„ã€‚æ„Ÿæƒ…ã«é£²ã¿è¾¼ã¾ã‚Œãšã€é©åˆ‡ãªå¯¾å¿œãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚",
                section3Title: "",
                section3Content: "",
                closingMessage: "ã€Œç†è§£ã™ã‚‹ã“ã¨ã¨åŒæ„ã™ã‚‹ã“ã¨ã¯é•ã„ã¾ã™ã€‚\nç›¸æ‰‹ã‚’ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹å¿ƒãŒã€é–¢ä¿‚æ€§ã‚’æ·±ã‚ã¦ã„ãã®ã§ã™ã€‚ã€"
            },
            day7: {
                subject: "ã€äººç”Ÿã®é“æ¨™ã€‘ä¸€é€±é–“ã®æŒ¯ã‚Šè¿”ã‚Šã¨æ„Ÿè¬",
                previewText: "ä¸€é€±é–“ãŠä»˜ãåˆã„ã„ãŸã ãã€å¿ƒã‹ã‚‰æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™",
                headerTitle: "ä¸€é€±é–“ã®æ­©ã¿ã¨æ„Ÿè¬",
                mainContent: "{firstName} æ§˜ã€ä¸€é€±é–“ãŠä»˜ãåˆã„ã„ãŸã ãã€å¿ƒã‹ã‚‰æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€‚\n\nã“ã®æ•°æ—¥é–“ã§ã€å°‘ã—ã§ã‚‚å¿ƒã«é™ã‘ã•ã‚„æ°—ã¥ããŒç”Ÿã¾ã‚ŒãŸã§ã—ã‚‡ã†ã‹ã€‚å°ã•ãªå¤‰åŒ–ã§ã‚‚ã€ãã‚Œã¯å¤§ããªä¸€æ­©ã§ã™ã€‚",
                section1Title: "ã“ã‚Œã‹ã‚‰ã‚‚å¿ƒã«ç•™ã‚ã¦ã„ãŸã ããŸã„ã“ã¨",
                section1Content: "ãƒ»å®Œç’§ã‚’æ±‚ã‚ãšã€ä»Šã“ã®ç¬é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨\nãƒ»å°ã•ãªæ„Ÿè¬ã‚’è¦‹ã¤ã‘ã‚‹ç¿’æ…£ã‚’ç¶šã‘ã‚‹ã“ã¨\nãƒ»å¿ƒãŒä¹±ã‚Œã¦ã‚‚ã€ãã‚Œã«æ°—ã¥ãè‡ªåˆ†ã‚’è¤’ã‚ã‚‹ã“ã¨\nãƒ»ä»–è€…ã¨ã®é–¢ã‚ã‚Šã®ä¸­ã§ã€ç†è§£ã™ã‚‹å¿ƒã‚’æŒã¡ç¶šã‘ã‚‹ã“ã¨",
                section2Title: "",
                section2Content: "",
                section3Title: "",
                section3Content: "",
                closingMessage: "äººç”Ÿã¨ã„ã†é“ã®ã‚Šã§ã€æ™‚ã«ã¯è¿·ã†ã“ã¨ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ãã‚“ãªã¨ãã€ã“ã“ã§ãŠä¼ãˆã—ãŸæ™ºæ…§ã‚’æ€ã„å‡ºã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚\n\nä»Šå¾Œã‚‚æ™‚ã€…ã€å¿ƒã®æ „é¤Šã¨ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãŠå±Šã‘ã„ãŸã—ã¾ã™ã€‚\nå¼•ãç¶šãã€ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"
            }
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éš ã™
            document.getElementById('basicContent').classList.add('hidden');
            document.getElementById('contentArea').classList.add('hidden');
            document.getElementById('advancedContent').classList.add('hidden');
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('basicTab').className = 'border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700';
            document.getElementById('contentTab').className = 'border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700';
            document.getElementById('advancedTab').className = 'border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700';
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            if (tabName === 'basic') {
                document.getElementById('basicContent').classList.remove('hidden');
                document.getElementById('basicTab').className = 'border-b-2 border-green-500 py-2 px-1 text-sm font-medium text-green-600';
            } else if (tabName === 'content') {
                document.getElementById('contentArea').classList.remove('hidden');
                document.getElementById('contentTab').className = 'border-b-2 border-green-500 py-2 px-1 text-sm font-medium text-green-600';
            } else if (tabName === 'advanced') {
                document.getElementById('advancedContent').classList.remove('hidden');
                document.getElementById('advancedTab').className = 'border-b-2 border-green-500 py-2 px-1 text-sm font-medium text-green-600';
            }
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            loadTemplate();
            showTab('basic');
        };

        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
        function loadTemplate() {
            const templateId = document.getElementById('templateSelect').value;
            const template = templates[templateId];
            
            document.getElementById('subject').value = template.subject;
            document.getElementById('previewText').value = template.previewText;
            document.getElementById('headerTitle').value = template.headerTitle;
            document.getElementById('mainContent').value = template.mainContent;
            document.getElementById('section1Title').value = template.section1Title;
            document.getElementById('section1Content').value = template.section1Content;
            document.getElementById('section2Title').value = template.section2Title;
            document.getElementById('section2Content').value = template.section2Content;
            document.getElementById('section3Title').value = template.section3Title;
            document.getElementById('section3Content').value = template.section3Content;
            document.getElementById('closingMessage').value = template.closingMessage;
            
            updatePreview();
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updatePreview() {
            const subject = document.getElementById('subject').value;
            const headerTitle = document.getElementById('headerTitle').value;
            const mainContent = document.getElementById('mainContent').value
                .replace(/\n/g, '<br>')
                .replace(/{firstName}/g, 'ç”°ä¸­')
                .replace(/{lastName}/g, 'å¤ªéƒ');
            
            const section1Title = document.getElementById('section1Title').value;
            const section1Content = document.getElementById('section1Content').value.replace(/\n/g, '<br>');
            const section2Title = document.getElementById('section2Title').value;
            const section2Content = document.getElementById('section2Content').value.replace(/\n/g, '<br>');
            const section3Title = document.getElementById('section3Title').value;
            const section3Content = document.getElementById('section3Content').value.replace(/\n/g, '<br>');
            const closingMessage = document.getElementById('closingMessage').value.replace(/\n/g, '<br>');
            
            document.getElementById('previewSubject').textContent = subject;
            
            let htmlContent = '';
            
            if (headerTitle) {
                htmlContent += `<h2 style="color: #2C5F41; font-size: 20px; margin-bottom: 20px;">${headerTitle}</h2>`;
            }
            
            if (mainContent) {
                htmlContent += `<p style="color: #333; line-height: 1.7; margin-bottom: 25px;">${mainContent}</p>`;
            }
            
            if (section1Title && section1Content) {
                htmlContent += `<div class="section-box">
                    <h3 style="color: #2C5F41; font-size: 16px; margin-bottom: 15px;">${section1Title}</h3>
                    <p style="color: #333; line-height: 1.6;">${section1Content}</p>
                </div>`;
            }
            
            if (section2Title && section2Content) {
                htmlContent += `<div class="section-box">
                    <h3 style="color: #2C5F41; font-size: 16px; margin-bottom: 15px;">${section2Title}</h3>
                    <p style="color: #333; line-height: 1.6;">${section2Content}</p>
                </div>`;
            }
            
            if (section3Title && section3Content) {
                htmlContent += `<div class="section-box">
                    <h3 style="color: #2C5F41; font-size: 16px; margin-bottom: 15px;">${section3Title}</h3>
                    <p style="color: #333; line-height: 1.6;">${section3Content}</p>
                </div>`;
            }
            
            if (closingMessage) {
                htmlContent += `<p style="color: #333; line-height: 1.7; margin-top: 25px;">${closingMessage}</p>`;
            }
            
            document.getElementById('emailPreview').innerHTML = htmlContent;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString('ja-JP');
        }

        // Google Sheetsã«ä¿å­˜
        async function saveToSheets() {
            const templateId = document.getElementById('templateSelect').value;
            const data = {
                templateId: templateId,
                subject: document.getElementById('subject').value,
                previewText: document.getElementById('previewText').value,
                headerTitle: document.getElementById('headerTitle').value,
                mainContent: document.getElementById('mainContent').value,
                section1Title: document.getElementById('section1Title').value,
                section1Content: document.getElementById('section1Content').value,
                section2Title: document.getElementById('section2Title').value,
                section2Content: document.getElementById('section2Content').value,
                section3Title: document.getElementById('section3Title').value,
                section3Content: document.getElementById('section3Content').value,
                closingMessage: document.getElementById('closingMessage').value,
                lastUpdated: new Date().toISOString()
            };
            
            try {
                const response = await fetch('/api/email-templates', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showNotification('âœ… Google Sheetsã«ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
                } else {
                    throw new Error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showNotification('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // Google Sheetsã‹ã‚‰åŒæœŸ
        async function syncFromSheets() {
            try {
                const templateId = document.getElementById('templateSelect').value;
                const response = await fetch(`/api/email-templates?templateId=${templateId}`);
                
                if (response.ok) {
                    const template = await response.json();
                    // ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
                    document.getElementById('subject').value = template.subject || '';
                    document.getElementById('previewText').value = template.previewText || '';
                    document.getElementById('headerTitle').value = template.headerTitle || '';
                    document.getElementById('mainContent').value = template.mainContent || '';
                    document.getElementById('section1Title').value = template.section1Title || '';
                    document.getElementById('section1Content').value = template.section1Content || '';
                    document.getElementById('section2Title').value = template.section2Title || '';
                    document.getElementById('section2Content').value = template.section2Content || '';
                    document.getElementById('section3Title').value = template.section3Title || '';
                    document.getElementById('section3Content').value = template.section3Content || '';
                    document.getElementById('closingMessage').value = template.closingMessage || '';
                    
                    updatePreview();
                    showNotification('ğŸ”„ Google Sheetsã‹ã‚‰åŒæœŸã—ã¾ã—ãŸï¼', 'success');
                } else {
                    throw new Error('åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showNotification('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
        async function sendTestEmail() {
            const testEmail = prompt("ãƒ†ã‚¹ãƒˆé€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", "");
            const subject = document.getElementById("templateSubject").value;
            const htmlContent = document.getElementById("templateContent").value;
            
            if (!testEmail) return;
            if (!subject || !htmlContent) {
                alert("ä»¶åã¨æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                return;
            }
            
            fetch("/api/admin/send-test-email", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    email: testEmail,
                    subject: subject,
                    htmlContent: htmlContent
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showNotification(`ğŸ“¨ ${testEmail} ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼`, "success");
                } else {
                    throw new Error(result.error || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
                }
            })
            .catch(error => {
                console.error("ãƒ†ã‚¹ãƒˆé€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
                showNotification(`âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, "error");
            });
            const templateId = document.getElementById('templateSelect').value;
            const testEmail = prompt('ãƒ†ã‚¹ãƒˆé€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:', 'å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›');
            
            if (!testEmail) return;
            
            try {
                const response = await fetch('/api/email-templates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        templateId: templateId,
                        email: testEmail,
                        firstName: 'ãƒ†ã‚¹ãƒˆ',
                        lastName: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'
                    })
                });
                
                if (response.ok) {
                    showNotification(`ğŸ“¨ ${testEmail} ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼`, 'success');
                } else {
                    throw new Error('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showNotification('âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>